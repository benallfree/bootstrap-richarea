"use strict";!function(t){function n(i){if(e[i])return e[i].exports;var o=e[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){!function(t){t(function(){jQuery.fn.visible=function(){return this.css("visibility","visible")},jQuery.fn.invisible=function(){return this.css("visibility","hidden")},jQuery.fn.visibilityToggle=function(){return this.css("visibility",function(t,n){return"visible"==n?"hidden":"visible"})},t.fn.richarea=function(n){var i=t(this);i.hide();var o=t('<div class=\'richarea\'><div class="richarea-editor">\n  <input :value="content" name="content" type="hidden"></input>\n  <input :value="itemsJson" name="itemJson" type="hidden"></input>\n  <ul class="sortable">\n    <li :class="{active: currentIdx==index }" :data-index="index" @click="select" @dblclick="edit" v-for="(item,index) in items">\n      <div class="tools">\n        <span class="move btn btn-success btn-xs glyphicon glyphicon-resize-vertical"></span>\n        <span @click="edit" class="add btn btn-default btn-xs glyphicon glyphicon-plus"></span>\n        <span @click="edit" class="settings btn btn-default btn-xs glyphicon glyphicon-cog"></span>\n        <span @click="duplicate" class="duplicate btn btn-default btn-xs glyphicon glyphicon-duplicate"></span>\n        <span @click="remove" class="delete btn btn-danger btn-xs glyphicon glyphicon-remove"></span>\n      </div>\n      <div class="item">\n        <component :forms="forms" :is="\'c\'+item.component_id" :item="item"></component>\n      </div>\n    </li>\n    <li class="disabled add text-center">\n      <button @click.prevent="add" class="btn btn-primary btn-xl">+</button>\n    </li>\n  </ul>\n  <div class="modal fade component-settings" role="dialog">\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button class="close" data-dismiss="modal" type="button">\n            <span class="glyphicon glyphicon-remove"></span>\n          </button>\n          <h4 class="modal-title">Edit Component</h4>\n        </div>\n        <div class="modal-body">\n          <template v-if="currentComponent">\n            <template v-if="Object.keys(currentComponent.fields).length>0">\n              <div v-for="(field,fieldName) in currentComponent.fields">\n                <div class="form-horizontal">\n                  <div class="form-group">\n                    <label class="col-xs-2 control-label">{{fieldName | titlecase}}</label>\n                    <div class="col-xs-10">\n                      <div v-if="field.editor==\'text\'">\n                        <input class="form-control" type="text" v-model="currentItem.data[fieldName]"></input>\n                      </div>\n                      <div v-if="field.editor==\'textarea\'">\n                        <textarea class="form-control" rows="3" v-model="currentItem.data[fieldName]"></textarea>\n                      </div>\n                      <div v-if="field.editor==\'link\'">\n                        <input class="form-control" type="text" v-model="currentItem.data[fieldName].href"></input>\n                        <input class="form-control" type="text" v-model="currentItem.data[fieldName].display"></input>\n                      </div>\n                      <div v-if="field.editor==\'image\'">\n                        <div :data-field="fieldName" class="image-editor">\n                          <input accept="image/gif,image/png,image/jpeg" class="cropit-image-input" type="file"></input>\n                          <img :src="currentItem.data[fieldName].croppedImage" class="reference" style="width:100%; display: none"/>\n                          <div class="cropit-preview"></div>\n                          <input class="cropit-image-zoom-input" type="range"></input>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </template>\n            <template v-else>\n              There are no fields to edit for this component.\n            </template>\n          </template>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-default" data-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <div class="modal modal-fullscreen fade components-modal" role="dialog">\n    <div class="modal-dialog component-selector" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button class="close" data-dismiss="modal">\n            <span class="glyphicon glyphicon-remove"></span>\n          </button>\n          <h4 class="modal-title">Add Component</h4>\n        </div>\n        <div class="modal-body">\n          <div>\n            <div :class="{\'btn-success\': selectedCategory == cat[0], \'btn-primary\': selectedCategory != cat[0] }" @click="selectCat(cat)" class="btn btn-xs" style="margin: 2px;" v-for="cat in componentCategories">\n              {{cat[1]}}\n            </div>\n          </div>\n          <img class="component" data-dismiss="modal" :data-component-id="component.id" :src="component.thumb" v-for="(component,index) in components" v-if="inActiveCategories(component)" v-on:click="insert(component.id)"/>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-default" data-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \n</div>\n</div>');i.after(o);var a=e(1);n=t.extend(!0,{},{root:o,items:[]},n),a.create(n)}})}(jQuery)},function(t,n,e){function i(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),a=e(2);a.init();var r=function(){function t(){i(this,t)}return o(t,null,[{key:"create",value:function(t){t=$.extend(!0,{},{componentCategories:[],userForms:[]},t),a.onInit(function(){function n(){return $(t.root).find(".richarea-editor")}function e(){return n().find(".sortable")}var i=a.ensureDefaultValues($.extend(!0,[],t.items));new Vue({el:n().get(0),data:{content:null,itemsJson:null,currentIdx:null,$currentComponent:null,items:i,components:a.components,componentCategories:t.componentCategories,selectedCategory:0,forms:t.userForms},computed:{currentItem:function(){return this.items[this.currentIdx]},currentComponent:function(){var t=this.items[this.currentIdx];return t?this.components[t.component_id]:null}},filters:{titlecase:function(t){var n=t.replace(/([A-Z])/g," $1"),e=n.charAt(0).toUpperCase()+n.slice(1);return e},jsonify:function(t){return JSON.stringify(t)}},watch:{currentIdx:function(t){this.isComponentSettingsInitialized=!1,this.$nextTick(function(){e().find(".tools").hide(),null!=t&&e().find("li.active .tools").show()})},items:{handler:function(t,n){this.calc()},deep:!0},isComponentSettingsInitialized:!1},methods:{add:function(){this.currentIdx=null;var t=n().find(".components-modal");t.modal("show")},selectCat:function(t){this.selectedCategory=t[0]},inActiveCategories:function(t){if(this.selectedCategory==-1)return!0;for(var n=0;n<t.categories.length;n++){var e=t.categories[n];if(this.selectedCategory==e)return!0}return!1},calc:function(){this.calcContent(),this.calcJson()},calcJson:function(){this.itemsJson=JSON.stringify(this.items)},calcContent:function(){var t=this;this.$nextTick(function(){var n=[];e().find(".item .component-container").each(function(t,e){var i=$(e).clone();i.find("[data-render]").each(function(t,n){var e=$(n);e.replaceWith(e.data("render"))}),["data-editor","data-field","data-default-value"].forEach(function(t){i.find("["+t+"]").removeAttr(t)});var o=i.html();n.push(o)});var i=$("<div>").addClass("richarea");i.html(n.join("\n")),t.content=i.get(0).outerHTML})},select:function(t){var n=$(t.target).closest("li");this.currentIdx=n.index(),this.$currentComponent=n},insert:function(t){var n=a.ensureDefaultValues({component_id:t}),i=e().find("li.active").index();i>=0?(this.items.splice(i,0,n),this.currentIdx=i):(this.items.push(n),this.currentIdx=this.items.length-1)},edit:function(t){var e=n().find(".component-settings");e.modal("show")},initCropper:function(e){var i=this,o=n().find(".component-settings");o.on("show.bs.modal",function(){i.isComponentSettingsInitialized||o.find(".image-editor").invisible()}),o.on("shown.bs.modal",function(){i.isComponentSettingsInitialized||o.find(".image-editor").each(function(n,e){var a=$(e),r=$(e).find(".reference"),s=Math.floor(r.actual("width")),c=Math.floor(r.actual("height")),l=(a.find(".export"),a.data("field")),d=!1;a.cropit({exportZoom:r.get(0).naturalWidth/s,imageBackground:!1,imageBackgroundBorderWidth:0,initialZoom:"fill",width:s,height:c,maxZoom:5,onFileReadError:function(){console.log("onFileReadError",arguments)},onImageError:function(){console.log("onImageError",arguments)},smallImage:"allow",onImageLoaded:function(){if(i.isComponentSettingsInitialized){d=!0;var n=a.find("[type=file]"),e=n.get(0).files[0];fr=new FileReader,fr.onload=function(){$.post(t.imageUploadUrl,{data:fr.result},function(t,n){console.log([t,n]),"success"==n&&"success"==t.status&&(i.items[i.currentIdx].data[l].originalImage=t.url,i.items[i.currentIdx].data[l].croppedImage=t.url)})},fr.readAsDataURL(e),i.$currentComponent.find("[data-field="+l+"]").attr("src",a.cropit("export"))}else a.cropit("zoom",i.currentItem.data[l].zoom),a.cropit("offset",i.currentItem.data[l].offset),i.isComponentSettingsInitialized=!0,o.find(".image-editor").visible()},onZoomChange:function(){i.isComponentSettingsInitialized&&(d=!0,i.items[i.currentIdx].data[l].zoom=a.cropit("zoom"),i.$currentComponent.find("[data-field="+l+"]").attr("src",a.cropit("export")))},onOffsetChange:function(){if(i.isComponentSettingsInitialized){d=!0;var t=a.cropit("offset");i.items[i.currentIdx].data[l].offset={x:Math.floor(t.x),y:Math.floor(t.y)},i.$currentComponent.find("[data-field="+l+"]").attr("src",a.cropit("export"))}}}),a.cropit("imageSrc",i.items[i.currentIdx].data[l].originalImage),o.on("hide.bs.modal",function(){d&&$.post(t.imageUploadUrl,{data:a.cropit("export")},function(t,n){console.log([t,n]),"success"==n&&"success"==t.status&&(i.items[i.currentIdx].data[l].croppedImage=t.url)})})})})},duplicate:function(t){this.items.splice(this.currentIdx,0,$.extend(!0,{},this.items[this.currentIdx]))},remove:function(t){var n=confirm("Are you sure you want to delete this item?");n&&(this.items.splice(this.currentIdx,1),this.currentIdx=null)}},mounted:function(){var t=this;this.calc(),n().show(),e().sortable({placeholder:"alert alert-warning",items:"li:not(.disabled)",handle:".move",helper:"clone",stop:function(n,i){i.placeholder.height(i.item.height()),i.placeholder.width(i.item[0].offsetWidth);var o=$(i.item),a=o.data("index"),r=o.index();t.items.move(a,r),t.currentIdx=r,e().sortable("cancel")},cursor:"move"}),this.initCropper(),$.prototype.fullscreen&&n().find(".components-modal").fullscreen()}})})}}]),t}();t.exports=r},function(t,n){function e(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),o=function(){function t(){e(this,t)}return i(t,null,[{key:"init",value:function(t){var n=this;t=$.extend(!0,{},{componentsUrl:"../dist/assets/components.html",userForms:null},t),this.isInitializing=!0,$(function(){$.get(t.componentsUrl,function(e){var i=$("<div>");i.html(e),i.children("div").each(function(e,i){var o=$(i),a={},r=o.data("id");o.find("[data-editor]").each(function(n,e){var i=($(e),$(e).data("default-value"));t.userForms&&!i&&"forms"==$(e).data("editor")&&(i=t.userForms[0].slug),a[$(e).data("field")]={editor:$(e).data("editor"),defaultValue:i}}),n.components[r]={id:o.data("id"),thumb:o.data("thumb"),fields:$.extend(!0,{},a),categories:o.data("cat")},Vue.component("c"+r,{props:["item","forms"],template:"<div class='component-container'>"+$(i).html()+"</div>",filters:{embedify:function(t){function n(t){var n=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,e=t.match(n);return e&&11==e[2].length?e[2]:"error"}var e=n(t);return"//www.youtube.com/embed/"+e},linebreak:function(t){return t.replace("\n","<br/>")}}})}),n.isInitialized=!0,n.callbacks.forEach(function(t){return t()})})})}},{key:"onInit",value:function(t){return this.isInitialized?t():void this.callbacks.push(t)}},{key:"ensureDefaultValues",value:function(t){var n=this;if(!this.isInitialized)throw new TypeError("ComponentLoader.init() must finish first.");if(t instanceof Array)return t.forEach(function(t){n.ensureDefaultValues(t)}),t;$.extend(!0,t,{data:{}});var e=this.components[t.component_id];if(e){var i=e.fields;return Object.keys(i).forEach(function(n){n in t.data||(t.data[n]=i[n].defaultValue)}),t}}}]),t}();o.callbacks=[],o.isInitialized=!1,o.components={},o.isInitializing=!1,t.exports=o}]);