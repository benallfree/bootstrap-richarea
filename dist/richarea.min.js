"use strict";!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){!function(t){t(function(){jQuery.fn.visible=function(){return this.css("visibility","visible")},jQuery.fn.invisible=function(){return this.css("visibility","hidden")},jQuery.fn.visibilityToggle=function(){return this.css("visibility",function(t,e){return"visible"==e?"hidden":"visible"})},t.fn.richarea=function(e){var i=t(this);i.hide();var o=t('<div class=\'richarea\'><div class="richarea-editor">\n  <input :value="content" name="content" type="hidden"></input>\n  <input :value="itemsJson" name="itemJson" type="hidden"></input>\n  <ul class="sortable">\n    <li :class="{active: currentIdx==index }" :data-index="index" @click="select" @dblclick="edit" v-for="(item,index) in items">\n      <div class="tools">\n        <span class="move btn btn-success btn-xs glyphicon glyphicon-resize-vertical"></span>\n        <span @click="edit" class="add btn btn-default btn-xs glyphicon glyphicon-plus"></span>\n        <span @click="edit" class="settings btn btn-default btn-xs glyphicon glyphicon-cog"></span>\n        <span @click="duplicate" class="duplicate btn btn-default btn-xs glyphicon glyphicon-duplicate"></span>\n        <span @click="remove" class="delete btn btn-danger btn-xs glyphicon glyphicon-remove"></span>\n      </div>\n      <div class="item">\n        <component :forms="forms" :is="\'c\'+item.component_id" :item="item"></component>\n      </div>\n    </li>\n    <li class="disabled add text-center">\n      <button @click.prevent="add" class="btn btn-primary btn-xl">+</button>\n    </li>\n  </ul>\n  <div class="modal fade component-settings" role="dialog">\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button class="close" data-dismiss="modal" type="button">\n            <span class="glyphicon glyphicon-remove"></span>\n          </button>\n          <h4 class="modal-title">Edit Component</h4>\n        </div>\n        <div class="modal-body">\n          <template v-if="currentComponent">\n            <template v-if="Object.keys(currentComponent.fields).length>0">\n              <div v-for="(field,fieldName) in currentComponent.fields">\n                <div class="form-horizontal">\n                  <div class="form-group">\n                    <label class="col-xs-2 control-label">{{fieldName | titlecase}}</label>\n                    <div class="col-xs-10">\n                      <div v-if="field.editor==\'text\'">\n                        <input class="form-control" type="text" v-model="currentItem.data[fieldName]"></input>\n                      </div>\n                      <div v-if="field.editor==\'textarea\'">\n                        <textarea class="form-control" rows="3" v-model="currentItem.data[fieldName]"></textarea>\n                      </div>\n                      <div v-if="field.editor==\'link\'">\n                        <input class="form-control" type="text" v-model="currentItem.data[fieldName].href"></input>\n                        <input class="form-control" type="text" v-model="currentItem.data[fieldName].display"></input>\n                      </div>\n                      <div v-if="field.editor==\'image\'">\n                        <div :data-field="fieldName" class="image-editor">\n                          <input accept="image/gif,image/png,image/jpeg" class="cropit-image-input" type="file"></input>\n                          <img :src="currentItem.data[fieldName].croppedImage" class="reference" style="width:100%; display: none"/>\n                          <div class="cropit-preview"></div>\n                          <input class="cropit-image-zoom-input" type="range"></input>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </template>\n            <template v-else>\n              There are no fields to edit for this component.\n            </template>\n          </template>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-default" data-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <div class="modal modal-fullscreen fade components-modal" role="dialog">\n    <div class="modal-dialog component-selector" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button class="close" data-dismiss="modal">\n            <span class="glyphicon glyphicon-remove"></span>\n          </button>\n          <h4 class="modal-title">Add Component</h4>\n        </div>\n        <div class="modal-body">\n          <div>\n            <div :class="{\'btn-success\': selectedCategory == cat[0], \'btn-primary\': selectedCategory != cat[0] }" @click="selectCat(cat)" class="btn btn-xs" style="margin: 2px;" v-for="cat in componentCategories">\n              {{cat[1]}}\n            </div>\n          </div>\n          <img class="component" data-dismiss="modal" :data-component-id="component.id" :src="component.thumb" v-for="(component,index) in components" v-if="inActiveCategories(component)" v-on:click="insert(component.id)"/>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-default" data-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \n</div>\n</div>');i.after(o);var a=n(1);e=t.extend(!0,{},{root:o,items:[]},e),a.create(e)}})}(jQuery)},function(t,e){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){n(this,t)}return i(t,null,[{key:"create",value:function(t){function e(e){var n=this;if(e instanceof Array)return e.forEach(function(t){n.ensureDefaultValues(t)}),e;$.extend(!0,e,{data:{}});var i=t.components[e.component_id];if(i){var o=i.fields;return Object.keys(o).forEach(function(t){t in e.data||(e.data[t]=o[t].defaultValue)}),e}}function n(){return $(t.root).find(".richarea-editor")}function i(){return n().find(".sortable")}t=$.extend(!0,{},{componentCategories:[],userForms:[],imageUploadUrl:null,components:null,items:[]},t),t.components.forEach(function(t){Vue.component("c"+t.id,{props:["item","forms"],template:"<div class='component-container'>"+t.template+"</div>",filters:{embedify:function(t){function e(t){var e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,n=t.match(e);return n&&11==n[2].length?n[2]:"error"}var n=e(t);return"//www.youtube.com/embed/"+n},linebreak:function(t){return t.replace("\n","<br/>")}}})});var o=e($.extend(!0,[],t.items));new Vue({el:n().get(0),data:{content:null,itemsJson:null,currentIdx:null,$currentComponent:null,items:o,components:t.components,componentCategories:t.componentCategories,selectedCategory:0,forms:t.userForms},computed:{currentItem:function(){return this.items[this.currentIdx]},currentComponent:function(){var t=this.items[this.currentIdx];return t?this.components[t.component_id]:null}},filters:{titlecase:function(t){var e=t.replace(/([A-Z])/g," $1"),n=e.charAt(0).toUpperCase()+e.slice(1);return n},jsonify:function(t){return JSON.stringify(t)}},watch:{currentIdx:function(t){this.isComponentSettingsInitialized=!1,this.$nextTick(function(){i().find(".tools").hide(),null!=t&&i().find("li.active .tools").show()})},items:{handler:function(t,e){this.calc()},deep:!0},isComponentSettingsInitialized:!1},methods:{add:function(){this.currentIdx=null;var t=n().find(".components-modal");t.modal("show")},selectCat:function(t){this.selectedCategory=t[0]},inActiveCategories:function(t){if(this.selectedCategory==-1)return!0;for(var e=0;e<t.categories.length;e++){var n=t.categories[e];if(this.selectedCategory==n)return!0}return!1},calc:function(){this.calcContent(),this.calcJson()},calcJson:function(){this.itemsJson=JSON.stringify(this.items)},calcContent:function(){var t=this;this.$nextTick(function(){var e=[];i().find(".item .component-container").each(function(t,n){var i=$(n).clone();i.find("[data-render]").each(function(t,e){var n=$(e);n.replaceWith(n.data("render"))}),["data-editor","data-field","data-default-value"].forEach(function(t){i.find("["+t+"]").removeAttr(t)});var o=i.html();e.push(o)});var n=$("<div>").addClass("richarea");n.html(e.join("\n")),t.content=n.get(0).outerHTML})},select:function(t){var e=$(t.target).closest("li");this.currentIdx=e.index(),this.$currentComponent=e},insert:function(t){var e=ComponentLoader.ensureDefaultValues({component_id:t}),n=i().find("li.active").index();n>=0?(this.items.splice(n,0,e),this.currentIdx=n):(this.items.push(e),this.currentIdx=this.items.length-1)},edit:function(t){var e=n().find(".component-settings");e.modal("show")},initCropper:function(e){var i=this,o=n().find(".component-settings");o.on("show.bs.modal",function(){i.isComponentSettingsInitialized||o.find(".image-editor").invisible()}),o.on("shown.bs.modal",function(){i.isComponentSettingsInitialized||o.find(".image-editor").each(function(e,n){var a=$(n),s=$(n).find(".reference"),r=Math.floor(s.actual("width")),c=Math.floor(s.actual("height")),l=(a.find(".export"),a.data("field")),d=!1;a.cropit({exportZoom:s.get(0).naturalWidth/r,imageBackground:!1,imageBackgroundBorderWidth:0,initialZoom:"fill",width:r,height:c,maxZoom:5,onFileReadError:function(){console.log("onFileReadError",arguments)},onImageError:function(){console.log("onImageError",arguments)},smallImage:"allow",onImageLoaded:function(){if(i.isComponentSettingsInitialized){d=!0;var e=a.find("[type=file]"),n=e.get(0).files[0];fr=new FileReader,fr.onload=function(){t.imageUploadUrl&&$.post(t.imageUploadUrl,{data:fr.result},function(t,e){console.log([t,e]),"success"==e&&"success"==t.status&&(i.items[i.currentIdx].data[l].originalImage=t.url,i.items[i.currentIdx].data[l].croppedImage=t.url)})},fr.readAsDataURL(n),i.$currentComponent.find("[data-field="+l+"]").attr("src",a.cropit("export"))}else a.cropit("zoom",i.currentItem.data[l].zoom),a.cropit("offset",i.currentItem.data[l].offset),i.isComponentSettingsInitialized=!0,o.find(".image-editor").visible()},onZoomChange:function(){i.isComponentSettingsInitialized&&(d=!0,i.items[i.currentIdx].data[l].zoom=a.cropit("zoom"),i.$currentComponent.find("[data-field="+l+"]").attr("src",a.cropit("export")))},onOffsetChange:function(){if(i.isComponentSettingsInitialized){d=!0;var t=a.cropit("offset");i.items[i.currentIdx].data[l].offset={x:Math.floor(t.x),y:Math.floor(t.y)},i.$currentComponent.find("[data-field="+l+"]").attr("src",a.cropit("export"))}}}),a.cropit("imageSrc",i.items[i.currentIdx].data[l].originalImage),o.on("hide.bs.modal",function(){d&&t.imageUploadUrl&&$.post(t.imageUploadUrl,{data:a.cropit("export")},function(t,e){console.log([t,e]),"success"==e&&"success"==t.status&&(i.items[i.currentIdx].data[l].croppedImage=t.url)})})})})},duplicate:function(t){this.items.splice(this.currentIdx,0,$.extend(!0,{},this.items[this.currentIdx]))},remove:function(t){var e=confirm("Are you sure you want to delete this item?");e&&(this.items.splice(this.currentIdx,1),this.currentIdx=null)}},mounted:function(){var t=this;this.calc(),n().show(),i().sortable({placeholder:"alert alert-warning",items:"li:not(.disabled)",handle:".move",helper:"clone",stop:function(e,n){n.placeholder.height(n.item.height()),n.placeholder.width(n.item[0].offsetWidth);var o=$(n.item),a=o.data("index"),s=o.index();t.items.move(a,s),t.currentIdx=s,i().sortable("cancel")},cursor:"move"}),this.initCropper(),$.prototype.fullscreen&&n().find(".components-modal").fullscreen()}})}}]),t}();t.exports=o}]);