"use strict";!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){i(1),function(t){t(function(){jQuery.fn.visible=function(){return this.css("visibility","visible")},jQuery.fn.invisible=function(){return this.css("visibility","hidden")},jQuery.fn.visibilityToggle=function(){return this.css("visibility",function(t,e){return"visible"==e?"hidden":"visible"})},t.fn.richarea=function(e){var n=t(this);n.hide();var o=t('<div class=\'richarea\'><div class="richarea-editor">\n  <ul class="sortable">\n    <li :class="{active: currentIdx==index }" :data-index="index" @click="select" @dblclick="edit" v-for="(item,index) in items">\n      <div class="tools">\n        <span class="move btn btn-success btn-xs glyphicon glyphicon-resize-vertical"></span>\n        <span @click="add(index)" class="add btn btn-default btn-xs glyphicon glyphicon-plus"></span>\n        <span @click="edit" class="settings btn btn-default btn-xs glyphicon glyphicon-cog"></span>\n        <span @click="duplicate" class="duplicate btn btn-default btn-xs glyphicon glyphicon-duplicate"></span>\n        <span @click="remove" class="delete btn btn-danger btn-xs glyphicon glyphicon-remove"></span>\n      </div>\n      <div class="item">\n        <layout :forms="forms" :is="\'c\'+item.layout_id" :item="item"></layout>\n      </div>\n    </li>\n    <li class="disabled add text-center">\n      <button @click.prevent="add(null)" class="btn btn-primary btn-xl">+</button>\n    </li>\n  </ul>\n  <div class="modal fade layout-settings" role="dialog">\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button class="close" @click="close">\n            <span class="glyphicon glyphicon-remove"></span>\n          </button>\n          <h4 class="modal-title">Edit Component</h4>\n        </div>\n        <div class="modal-body">\n          <template v-if="currentLayout">\n            <template v-if="Object.keys(currentLayout.fields).length>0">\n              <div v-for="(field,fieldName) in currentLayout.fields">\n                <div class="form-horizontal">\n                  <div class="form-group">\n                    <label class="col-xs-2 control-label">{{fieldName | titlecase}}</label>\n                    <div class="col-xs-10">\n                      <component :is="\'edit-\'+field.editor" :item="currentItem" :field-name="fieldName"></component>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </template>\n            <template v-else>\n              There are no fields to edit for this layout.\n            </template>\n          </template>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-default"  @click="close">Close</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <div class="modal modal-fullscreen fade layouts-modal" role="dialog">\n    <div class="modal-dialog layout-selector" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button class="close" data-dismiss="modal">\n            <span class="glyphicon glyphicon-remove"></span>\n          </button>\n          <h4 class="modal-title">Add Component</h4>\n        </div>\n        <div class="modal-body">\n          <div>\n            <div :class="{\'btn-success\': selectedCategory == cat[0], \'btn-primary\': selectedCategory != cat[0] }" @click="selectCat(cat)" class="btn btn-xs" style="margin: 2px;" v-for="cat in layoutCategories">\n              {{cat[1]}}\n            </div>\n          </div>\n          <img class="layout" data-dismiss="modal" :data-layout-id="layout.id" :src="layout.thumb" v-for="(layout,index) in layouts" v-if="inActiveCategories(layout)" v-on:click="insert(layout.id)"/>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-default" data-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \n</div>\n</div>');n.after(o);var a=i(2);e=t.extend(!0,{},{root:o,items:[]},e),a.create(e)}})}(jQuery)},function(t,e){!function(){Array.prototype.move||(Array.prototype.move=function(t,e){for(;t<0;)t+=this.length;for(;e<0;)e+=this.length;if(e>=this.length)for(var i=e-this.length;i--+1;)this.push(void 0);return this.splice(e,0,this.splice(t,1)[0]),this})}(void 0)},function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(){function t(){n(this,t)}return o(t,null,[{key:"create",value:function(t){function e(e){var i=this;if(e instanceof Array)return e.forEach(function(t){i.ensureDefaultValues(t)}),e;$.extend(!0,e,{data:{}});var n=t.layouts[e.layout_id];if(n){var o=n.fields;return Object.keys(o).forEach(function(t){t in e.data||(e.data[t]=o[t].defaultValue)}),e}}function n(){return $(t.root).find(".richarea-editor")}function o(){return n().find(".sortable")}if(t=$.extend(!0,{},{layoutCategories:i(3),userForms:[],imageUploadUrl:null,layouts:i(4),items:[],addLayouts:[],editors:{"edit-text":i(5),"edit-textarea":i(6),"edit-link":i(7),"edit-image":i(8)}},t),0==Object.keys(t.layouts).length)throw new TypeError("You must define at least one layout.");var a=t.editors;t.extraLayouts.forEach(function(e){t.layouts[e.id]=e}),Object.keys(t.layouts).forEach(function(e){var i=t.layouts[e];a["c"+i.id]={props:["item","forms"],template:"<div class='layout-container'>"+i.template+"</div>",filters:{embedify:function(t){function e(t){var e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,i=t.match(e);return i&&11==i[2].length?i[2]:"error"}var i=e(t);return"//www.youtube.com/embed/"+i},linebreak:function(t){return t.replace("\n","<br/>")}}}});var l=e($.extend(!0,[],t.items));new Vue({components:a,el:n().get(0),data:{content:null,itemsJson:null,currentIdx:null,$currentLayout:null,items:l,layouts:t.layouts,layoutCategories:t.layoutCategories,selectedCategory:0,forms:t.userForms},computed:{currentItem:function(){return this.items[this.currentIdx]},currentLayout:function(){var t=this.items[this.currentIdx];return t?this.layouts[t.layout_id]:null}},filters:{titlecase:function(t){var e=t.replace(/([A-Z])/g," $1"),i=e.charAt(0).toUpperCase()+e.slice(1);return i},jsonify:function(t){return JSON.stringify(t)}},watch:{currentIdx:function(t){this.$nextTick(function(){o().find(".tools").hide(),null!=t&&o().find("li.active .tools").show()})},items:{handler:function(t,e){this.calc()},deep:!0}},methods:{add:function(t){this.currentIdx=t;var e=n().find(".layouts-modal");e.modal("show")},selectCat:function(t){this.selectedCategory=t[0]},inActiveCategories:function(t){if(this.selectedCategory==-1)return!0;!t.categories;for(var e=0;e<t.categories.length;e++){var i=t.categories[e];if(this.selectedCategory==i)return!0}return!1},notifyChange:function(){t.onChange&&t.onChange({html:this.content,data:this.items})},close:function(){n().find(".modal.in").modal("hide"),this.calc()},calc:function(){var t=this;this.$nextTick(function(){n().find(".modal.layout-settings.in").length>0||(t.calcContent(),t.calcJson(),t.notifyChange())})},calcJson:function(){this.itemsJson=JSON.stringify(this.items)},calcContent:function(){var t=[];o().find(".item .layout-container").each(function(e,i){var n=$(i).clone();n.find("[data-render]").each(function(t,e){var i=$(e);i.replaceWith(i.data("render"))}),["data-editor","data-field","data-default-value"].forEach(function(t){n.find("["+t+"]").removeAttr(t)});var o=n.html();t.push(o)});var e=$("<div>").addClass("richarea");e.html(t.join("\n")),this.content=e.get(0).outerHTML},select:function(t){var e=$(t.target).closest("li");this.currentIdx=e.index(),this.$currentLayout=e},insert:function(t){var i=e({layout_id:t}),n=o().find("li.active").index();n>=0?(this.items.splice(n,0,i),this.currentIdx=n):(this.items.push(i),this.currentIdx=this.items.length-1)},edit:function(t){var e=n().find(".layout-settings");e.modal("show")},duplicate:function(t){this.items.splice(this.currentIdx,0,$.extend(!0,{},this.items[this.currentIdx]))},remove:function(t){var e=confirm("Are you sure you want to delete this item?");e&&(this.items.splice(this.currentIdx,1),this.currentIdx=null)}},mounted:function(){var t=this;this.calc(),n().show(),o().sortable({placeholder:"alert alert-warning",items:"li:not(.disabled)",handle:".move",helper:"clone",stop:function(e,i){i.placeholder.height(i.item.height()),i.placeholder.width(i.item[0].offsetWidth);var n=$(i.item),a=n.data("index"),l=n.index();t.items.move(a,l),t.currentIdx=l,o().sortable("cancel")},cursor:"move"}),$.prototype.fullscreen&&n().find(".layouts-modal").fullscreen()}})}}]),t}();t.exports=a},function(t,e){t.exports=[[0,"Default"],[35,"Forms"],[-1,"All"],[1,"Title"],[2,"Title, Subtitle"],[3,"Info, Title"],[4,"Info, Title, Subtitle"],[5,"Heading, Paragraph"],[6,"Paragraph"],[7,"Paragraph, Images + Caption"],[8,"Heading, Paragraph, Images + Caption"],[9,"Images + Caption"],[10,"Images + Long Caption"],[11,"Images"],[12,"Single Image"],[13,"Call to Action"],[14,"List"],[15,"Quotes"],[16,"Profile"],[17,"Map"],[20,"Video"],[18,"Social"],[21,"Services"],[22,"Contact Info"],[23,"Pricing"],[24,"Team Profile"],[25,"Products/Portfolio"],[26,"How It Works"],[27,"Partners/Clients"],[28,"As Featured On"],[29,"Achievements"],[32,"Skills"],[30,"Coming Soon"],[31,"Page Not Found"],[33,"Buy Now"],[34,"Panels"],[19,"Separator"]]},function(t,e){t.exports=[]},function(t,e){t.exports={props:["item","fieldName"],template:'<input class="form-control" type="text" v-model="item.data[fieldName]"/>'}},function(t,e){t.exports={props:["item","fieldName"],template:'<textarea class="form-control" rows="3" v-model="item.data[fieldName]"></textarea>'}},function(t,e){t.exports={props:["item","fieldName"],template:'\n    <div>\n      <input class="form-control" type="text" v-model="item.data[fieldName].href"></input>\n      <input class="form-control" type="text" v-model="item.data[fieldName].display"></input>\n    </div>\n  '}},function(t,e){t.exports={props:["item","fieldName"],template:'\n    <div>\n      <div :data-field="fieldName" class="image-editor">\n        <input accept="image/gif,image/png,image/jpeg" class="cropit-image-input" type="file"></input>\n        <img :src="item.data[fieldName].croppedImage" class="reference" style="width:100%; display: none"/>\n        <div class="cropit-preview"></div>\n        <input class="cropit-image-zoom-input" type="range"></input>\n      </div>\n    </div>\n  ',data:{isCropperInitialized:!1},computed:{field:function(){return this.item.data[this.fieldName]}},mounted:function(){var t=this,e=$(this.$el),i=e.closest(".modal");i.on("show.bs.modal",function(){t.isCropperInitialized||i.find(".image-editor").invisible()}),i.on("shown.bs.modal",function(){if(!t.isCropperInitialized){var n=0,o=e.find(".image-editor"),a=o.find(".reference"),l=Math.floor(a.actual("width")),s=Math.floor(a.actual("height")),r=(o.find(".export"),!1);n++,o.cropit({exportZoom:a.get(0).naturalWidth/l,imageBackground:!1,imageBackgroundBorderWidth:0,initialZoom:"image",width:l,height:s,maxZoom:5,onFileReadError:function(){console.log("onFileReadError",arguments)},onImageError:function(){console.log("onImageError",arguments)},smallImage:"allow",onImageLoaded:function(){if(t.isCropperInitialized){r=!0;var e=o.find("[type=file]"),a=e.get(0).files[0];fr=new FileReader,fr.onload=function(){options.imageUploadUrl&&$.post(options.imageUploadUrl,{data:fr.result},function(e,i){console.log([e,i]),"success"==i&&"success"==e.status&&(t.field.originalImage=e.url,t.field.croppedImage=e.url)})},fr.readAsDataURL(a),t.field.croppedImage=o.cropit("export")}else o.cropit("zoom",t.field.zoom),o.cropit("offset",t.field.offset),n--,0==n&&(t.isCropperInitialized=!0),i.find(".image-editor").visible()},onZoomChange:function(){t.isCropperInitialized&&(r=!0,t.field.zoom=o.cropit("zoom"),t.field.croppedImage=o.cropit("export"))},onOffsetChange:function(){if(t.isCropperInitialized){r=!0;var e=o.cropit("offset");t.field.offset={x:Math.floor(e.x),y:Math.floor(e.y)},t.field.croppedImage=o.cropit("export")}}}),o.cropit("imageSrc",t.field.originalImage),i.on("hide.bs.modal",function(){r&&options.imageUploadUrl&&$.post(options.imageUploadUrl,{data:o.cropit("export")},function(e,i){console.log([e,i]),"success"==i&&"success"==e.status&&(t.field.croppedImage=e.url)})})}})}}}]);